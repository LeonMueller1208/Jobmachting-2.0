generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Applicant {
  id              String     @id @default(cuid())
  name            String
  email           String?    @unique
  passwordHash    String?    // Hashed password (optional - set when user interacts)
  skills          Json
  location        String
  experience      Int
  education       String?    // Highest degree: "Hauptschulabschluss", "Realschulabschluss", "Abitur", "Bachelor", "Master", "Promotion"
  fieldOfStudy    String?    // Field of study (nur bei Uni-Abschluss): "BWL", "VWL", etc.
  fieldOfStudyCategory String? // Category: "Wirtschaft", "Ingenieurwesen", "Sonstige"
  bio             String?
  industry        String?
  hierarchy       Int?       // 1-4: "very_flat" | "rather_flat" | "rather_clear" | "very_clear"
  autonomy        Int?       // 1-4: "very_little" | "some" | "much" | "very_much"
  teamwork        Int?       // 1-4: "very_important" | "important" | "rather_unimportant" | "unimportant"
  workStructure   Int?       // 1-5: Likert scale
  feedback        Int?       // 1-5: Likert scale
  flexibility     Int?       // 1-4: "very_important" | "important" | "rather_unimportant" | "unimportant"
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt
  interests       Interest[]
  chats           Chat[]
}

model Company {
  id           String        @id @default(cuid())
  name         String
  email        String?       @unique
  passwordHash String?       // Hashed password (optional - set when user interacts)
  industry     String
  location     String
  description  String?       // Company description/bio
  website      String?       // Company website URL
  companySize  String?       // Company size: "1-10", "11-50", "51-200", "201-500", "500+"
  foundedYear  Int?          // Year the company was founded
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  jobs         Job[]
  chats        Chat[]
  chatTemplates ChatTemplate[]
}

model Job {
  id                String     @id @default(cuid())
  title             String
  description       String
  requiredSkills    Json
  location          String
  minExperience     Int
  requiredEducation String?    // Minimum required: "Hauptschulabschluss", "Realschulabschluss", "Abitur", "Bachelor", "Master", "Promotion", "Keine Angabe"
  requiredFieldsOfStudy Json?  // Array of required fields: ["BWL", "VWL"], empty/null = all accepted
  jobType           String?    // Job type: "Vollzeit", "Teilzeit", "Praktikum", "Werkstudent", "Minijob", "Freelance", "Ausbildung"
  companyId         String
  createdAt         DateTime   @default(now())
  updatedAt         DateTime   @updatedAt
  industry          String?
  hierarchy         Int?       // 1-4: "very_flat" | "rather_flat" | "rather_clear" | "very_clear"
  autonomy          Int?       // 1-4: "very_little" | "some" | "much" | "very_much"
  teamwork          Int?       // 1-4: "very_important" | "important" | "rather_unimportant" | "unimportant"
  workStructure     Int?       // 1-5: Likert scale
  feedback          Int?       // 1-5: Likert scale
  flexibility       Int?       // 1-4: "very_important" | "important" | "rather_unimportant" | "unimportant"
  interests         Interest[]
  chats             Chat[]
  company           Company    @relation(fields: [companyId], references: [id])
}

model Interest {
  id           String    @id @default(cuid())
  applicantId  String
  jobId        String
  status       String    // "INTERESTED", "NOT_INTERESTED", "COMPANY_REJECTED"
  matchScore   Float
  culturalFit  Float?    // Cultural fit score (0-100)
  passes       Boolean
  companyNote  String?   // Optional note from company when rejecting applicant
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  job          Job       @relation(fields: [jobId], references: [id])
  applicant    Applicant @relation(fields: [applicantId], references: [id])

  @@unique([applicantId, jobId])
}

model Chat {
  id                  String    @id @default(cuid())
  applicantId         String
  companyId           String
  jobId               String
  archivedByApplicant Boolean   @default(false)
  archivedByCompany   Boolean   @default(false)
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  messages            Message[]
  applicant           Applicant @relation(fields: [applicantId], references: [id])
  company             Company   @relation(fields: [companyId], references: [id])
  job                 Job       @relation(fields: [jobId], references: [id])

  @@unique([applicantId, companyId, jobId])
}

model Message {
  id        String   @id @default(cuid())
  chatId    String
  senderId  String
  senderType String // "applicant" or "company"
  content   String
  read      Boolean  @default(false)
  createdAt DateTime @default(now())
  chat      Chat     @relation(fields: [chatId], references: [id], onDelete: Cascade)
}

model ChatTemplate {
  id        String   @id @default(cuid())
  companyId String
  name      String
  content   String
  isDefault Boolean  @default(false) // true for predefined templates
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  company   Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
}
